{% extends "layout.html" %}

{% block navbar_left %}{% endblock %}

{% block in_head %}
<script src="{{ url_for('static', filename='vendor/stream_table-1.1.1.min.js') }}" type="text/javascript"></script>
<script src="{{ url_for('static', filename='index.js') }}" type="text/javascript"></script>
<script type="text/javascript">
  $.getJSON("/api/phenos")
  .done(function(data) {
  data.forEach(function(datum) {
  if (datum.gc_lambda) {
    datum.lambda = datum.gc_lambda['0.5']
  }
  })
    window.phenolist = data;
      populate_streamtable(data);
  })
  .fail(function() {
      console.log("Phenolist XHR failed");
  });
</script>
<style type="text/css">
  .navbar-default {
    border: none;
  }
</style>
{% endblock %}

{% block contained %}

<br style="margin-top:2em">
{% if current_user and not current_user.is_authenticated %}
<div class="row">
  <div class="col-xs-10 col-xs-offset-1">
    <div class="jumbotron">
      <p>Please log in to view this data.</p>
      <br>
      <p><a class="btn-lg btn-primary" role="button" href="{{ url_for('login_with_google') }}">Click here to login with Google</a></p>
      <br>
      <p style="margin-bottom:0">
        If your email address is on the whitelist but is not connected to a Google account, please
        <a href="https://accounts.google.com/SignUpWithoutGmail">create a Google account for it</a>.
      </p>
    </div>
  </div>
</div>
{% else %}
<br style="margin-top: 3em">
{% endif %}

<div class="row">
    <div class="col-xs-12 col-sm-offset-1 col-sm-10">
        <h1>{% include 'index/h1.html' %}</h1>
        {% include 'index/below-h1.html' ignore missing %}
    </div>
</div>

<div class="row">
    <div class="col-xs-12 col-sm-offset-1 col-sm-10">
        <ul class="nav nav-tabs" role="tablist">
          <li class="active nav-item">
            <a class="nav-link active" id="search-general-tab" data-toggle="tab" href="#search-general" role="tab" aria-controls="search-general" aria-selected="true">Search</a>
          </li>
          <li class="nav-item">
              <a class="nav-link" id="phenotypes-tab" data-toggle="tab" href="#phenotypes" role="tab" aria-controls="phenotypes" aria-selected="false">Phenotype list</a>
          </li>
        </ul>
    <div class="tab-content">
      <div class="tab-pane active" id="search-general" role="tabpanel" style="padding-top: 20px;">
        <div id="home-searchbox">
            <form action="/go">
             <fieldset>
              <div class="form-group">
                <input name="query" id="query" class="form-control typeahead" type="text" placeholder="Search for a variant, gene, or phenotype" autofocus>
            </div>
        </fieldset>
    </form>
    {% include 'index/below-query.html' ignore missing %}
    </div>
  </div>
  <div class="tab-pane" id="phenotypes" role="tabpanel" style="padding-top: 20px;">
    <input type="text" class="form-control" id="search" placeholder="Search for a phenotype">
    <div class="btn-group btn-group-toggle" data-toggle="buttons" style="display: block; padding-top: 10px;">
      <label class="btn btn-primary active">
        <input type="radio" name="options" id="button-phenostring" autocomplete="off" checked> Search by name
    </label>
    <label class="btn btn-primary">
        <input type="radio" name="options" id="button-category" autocomplete="off"> Search by category
    </label>
    </div>
    <h5 class="pull-left" style="clear: both;"><div id="phenolist-streamtable-found" class="label label-primary"></div></h5>
    <table id="stream_table" class="table table-striped table-bordered">
        <thead>
          <tr>
            <th style="cursor: pointer;" data-sort="phenostring:asc">phenotype</th>
            <th style="cursor: pointer;" data-sort="category:asc">category</th>
            <th style="cursor: pointer;" data-sort="num_cases:desc:number">number of cases</th>
            <th style="cursor: pointer;" data-sort="num_controls:desc:number">number of controls</th>
            <th style="cursor: pointer;" data-sort="num_gw_significant:desc:number">genome-wide significant loci</th>
            <th style="cursor: pointer;" data-sort="lambda:desc:number">genomic control lambda</th>
          </tr>
    </thead>
    <tbody>
    </tbody>
    </table>
  </div>
    </div>
    </div>
</div>

<script type="text/template" id="phenolist-streamtable-template">
    <tr>
        <td style="width:45%;"><a style="color:black" href="/pheno/<%= p.phenocode %>"><%= p.phenostring %></a></td>
        <td style="width:25%;"><%= p.category %></td>
        <td style="width:6%; text-align: right;"><%= p.num_cases %></td>
        <td style="width:6%; text-align: right;"><%= p.num_controls %></td>
        <td style="width:6%; text-align: right;"><%= p.num_gw_significant %></td>
        <td style="width:6%; text-align: right;"><%= p.lambda %></td>
    </tr>
</script>

{% endblock %}
